package nl.pvanassen.opc

import org.junit.jupiter.api.Disabled
import org.junit.jupiter.api.Test
import java.util.*
import java.util.function.Consumer

class ConnectionReopenTest {

    @Test
    @Disabled("Requires local setup")
    fun reopenTest() {
        val random = Random()
        val opc = Opc.builder("localhost", 7890).addDevice()
            .addPixelStrip(20)
            .addPixelStrip(20)
            .addPixelStrip(20)
            .addPixelStrip(20)
            .addPixelStrip(20)
            .addPixelStrip(20)
            .addPixelStrip(20)
            .addPixelStrip(20)
            .createDevice()
            .addErrorListener(Consumer { ex -> ex.printStackTrace() })
            .build()
        while (true) {
            repeat((0 until 10).count()) {
                opc.setPixelColor(random.nextInt(8), random.nextInt(20), random.nextInt())
            }
            opc.flush()
            Thread.sleep(5)
        }
    }
}